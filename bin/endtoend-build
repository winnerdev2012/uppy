#!/usr/bin/env bash

echo "Preparing for end to end test: copying static HTML and CSS, building JS"
rm -rf ./test/endtoend/dist && mkdir ./test/endtoend/dist
rm -rf ./test/endtoend/node_modules

UPPY_VERSION=$(cat package.json | grep version | head -1 | awk -F= "{ print $2 }" | sed 's/[version:,\",]//g' | tr -d '[[:space:]]')
# archive the uppy package
npm pack
# install from the archived uppy package
npm install --prefix ./test/endtoend uppy-${UPPY_VERSION}.tgz

cp ./test/endtoend/node_modules/uppy/dist/uppy.min.css ./test/endtoend/dist
cp ./test/endtoend/src/index.html ./test/endtoend/dist
browserify ./test/endtoend/src/main.js -o ./test/endtoend/dist/bundle.js -t babelify